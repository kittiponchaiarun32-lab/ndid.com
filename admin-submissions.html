<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</title>
  <style>
    /* Theme */
    :root{--primary:#667eea;--primary-dark:#764ba2;--accent:#ffd24d;--accent-dark:#f2b705;--danger:#ff6b6b;--success:#51cf66;--muted:#6b6b6b;--bg:#f5f7fa;--card:#fff}
    
    *{box-sizing:border-box}
    html,body{margin:0;font-family:'Inter', '-apple-system', 'Segoe UI', 'Roboto', sans-serif;-webkit-font-smoothing:antialiased;background:var(--bg);color:#333}

    /* Header */
    header{background:linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);color:#fff;padding:20px 24px;box-shadow:0 2px 12px rgba(0,0,0,0.1)}
    header h1{margin:0;font-size:20px;font-weight:800}
    header .subtitle{margin:0;font-size:13px;opacity:0.9;margin-top:4px}

    /* Container */
    .container{max-width:1400px;margin:0 auto;padding:24px}

    /* Top bar */
    .top-bar{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:24px;flex-wrap:wrap}
    .top-bar > div{display:flex;gap:12px;align-items:center}

    /* Search & Filter */
    .search-box, .date-filter{
      padding:10px 14px;
      border:1.5px solid #e0e0e0;
      border-radius:10px;
      font-size:13px;
      font-family:inherit;
      background:var(--card);
      transition:all 0.2s;
    }
    .search-box:focus, .date-filter:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(102,126,234,0.1)}

    /* Buttons */
    .btn{
      padding:10px 16px;
      border:0;
      border-radius:8px;
      font-weight:700;
      cursor:pointer;
      transition:all 0.2s;
      font-size:13px;
      letter-spacing:0.3px;
    }
    .btn-primary{background:linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);color:#fff;box-shadow:0 2px 8px rgba(102,126,234,0.3)}
    .btn-primary:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(102,126,234,0.4)}
    .btn-secondary{background:#f5f5f5;color:#333;border:1px solid #e0e0e0}
    .btn-secondary:hover{background:#efefef}
    .btn-danger{background:var(--danger);color:#fff;font-size:12px;padding:6px 10px}
    .btn-danger:hover{opacity:0.9}
    .btn-success{background:var(--success);color:#fff;font-size:12px;padding:6px 10px}
    .btn-success:hover{opacity:0.9}
    .btn:disabled{opacity:0.5;cursor:not-allowed}

    /* Table */
    .table-wrapper{
      background:var(--card);
      border-radius:12px;
      overflow:auto;
      box-shadow:0 2px 12px rgba(0,0,0,0.08);
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }

    thead{background:#f9f9f9;border-bottom:2px solid #e0e0e0}
    th{
      padding:14px;
      text-align:left;
      font-weight:700;
      color:#333;
      white-space:nowrap;
      cursor:pointer;
      user-select:none;
    }
    th:hover{background:#f0f0f0}

    td{
      padding:12px 14px;
      border-bottom:1px solid #f0f0f0;
      word-break:break-word;
      max-width:200px;
    }

    tr:hover{background:#f9f9f9}

    /* Badge */
    .badge{
      display:inline-block;
      padding:4px 10px;
      border-radius:6px;
      font-size:11px;
      font-weight:700;
      text-align:center;
    }
    .badge-confirmed{background:#d4f5d4;color:#2d5a2d}
    .badge-pending{background:#fff3cd;color:#856404}
    .badge-rejected{background:#f8d7da;color:#721c24}

    /* Status indicator */
    .status-icon{
      display:inline-block;
      width:12px;
      height:12px;
      border-radius:50%;
      margin-right:6px;
    }
    .status-icon.confirmed{background:var(--success)}
    .status-icon.pending{background:#ffc107}
    .status-icon.rejected{background:var(--danger)}

    /* Modal */
    .modal{
      display:none;
      position:fixed;
      top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.5);
      z-index:1000;
      align-items:center;
      justify-content:center;
    }
    .modal.active{display:flex}
    .modal-content{
      background:var(--card);
      border-radius:12px;
      padding:24px;
      max-width:600px;
      width:90%;
      max-height:80vh;
      overflow-y:auto;
      box-shadow:0 10px 40px rgba(0,0,0,0.3);
    }

    .modal-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:20px;
    }
    .modal-header h2{margin:0;font-size:18px}
    .modal-close{
      background:none;
      border:none;
      font-size:24px;
      cursor:pointer;
      color:#999;
    }

    .form-group{margin-bottom:16px}
    .form-group label{
      display:block;
      font-size:12px;
      font-weight:600;
      margin-bottom:6px;
      color:#333;
    }
    .form-group input, .form-group textarea, .form-group select{
      width:100%;
      padding:10px;
      border:1.5px solid #e0e0e0;
      border-radius:8px;
      font-size:13px;
      font-family:inherit;
      background:#fff;
    }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus{
      outline:none;
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(102,126,234,0.1);
    }

    /* Stats */
    .stats{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));
      gap:12px;
      margin-bottom:20px;
    }
    .stat-card{
      background:var(--card);
      padding:16px;
      border-radius:10px;
      border-left:4px solid var(--primary);
      box-shadow:0 2px 8px rgba(0,0,0,0.06);
    }
    .stat-label{font-size:12px;color:#999;margin-bottom:6px}
    .stat-value{font-size:24px;font-weight:800;color:#1a1a1a}

    /* Pagination */
    .pagination{
      display:flex;
      justify-content:center;
      gap:6px;
      margin-top:20px;
    }
    .pagination button{
      padding:8px 12px;
      border:1px solid #e0e0e0;
      background:#fff;
      border-radius:6px;
      cursor:pointer;
      font-size:12px;
      font-weight:600;
    }
    .pagination button.active{background:var(--primary);color:#fff;border-color:var(--primary)}
    .pagination button:hover:not(.active){background:#f5f5f5}

    /* Responsive */
    @media (max-width:768px){
      .container{padding:16px}
      .top-bar{flex-direction:column}
      .top-bar > div{width:100%;flex-direction:column}
      table{font-size:12px}
      td{padding:8px 10px}
      .modal-content{width:95%}
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <h1>üìã ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h1>
    <div class="subtitle">‡∏î‡∏π‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
  </header>

  <!-- Main Content -->
  <div class="container">
    <!-- Stats -->
    <div class="stats" id="statsContainer">
      <div class="stat-card">
        <div class="stat-label">üìä ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        <div class="stat-value" id="totalCount">0</div>
      </div>
      <div class="stat-card" style="border-left-color:#51cf66">
        <div class="stat-label">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div>
        <div class="stat-value" id="confirmedCount">0</div>
      </div>
      <div class="stat-card" style="border-left-color:#ffc107">
        <div class="stat-label">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
        <div class="stat-value" id="pendingCount">0</div>
      </div>
      <div class="stat-card" style="border-left-color:#ff6b6b">
        <div class="stat-label">‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</div>
        <div class="stat-value" id="rejectedCount">0</div>
      </div>
    </div>

    <!-- Top Bar -->
    <div class="top-bar">
      <div>
        <input type="text" id="searchInput" class="search-box" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡πÄ‡∏ö‡∏≠‡∏£‡πå, ‡∏≠‡∏µ‡πÄ‡∏°‡∏•...">
        <select id="statusFilter" class="search-box">
          <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
          <option value="confirmed">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
          <option value="pending">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
          <option value="rejected">‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</option>
        </select>
      </div>
      <div>
        <button class="btn btn-primary" onclick="exportToCSV()">üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV</button>
        <button class="btn btn-secondary" onclick="location.reload()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
      </div>
    </div>

    <!-- Table -->
    <div class="table-wrapper">
      <table id="submissionsTable">
        <thead>
          <tr>
            <th onclick="sortTable('id')">ID üîΩ</th>
            <th onclick="sortTable('timestamp')">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£ üîΩ</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
            <th>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</th>
            <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå ID</th>
            <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
            <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏ö‡∏µ‡πâ‡∏¢</th>
            <th>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</th>
            <th>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <tr><td colspan="11" style="text-align:center;color:#999;padding:40px">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination" id="pagination"></div>
  </div>

  <!-- Accounts Modal -->
  <div class="modal" id="accountsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å</h2>
        <button class="modal-close" onclick="closeAccountsModal()">&times;</button>
      </div>
      <div id="accountsModalBody" style="font-size:14px;color:#333;line-height:1.6">
        <!-- filled dynamically -->
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
        <button class="modal-close" onclick="closeEditModal()">&times;</button>
      </div>
      <form id="editForm">
        <div class="form-group">
          <label>‡∏ä‡∏∑‡πà‡∏≠</label>
          <input type="text" id="editFirstName" required>
        </div>
        <div class="form-group">
          <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
          <input type="text" id="editLastName" required>
        </div>
        <div class="form-group">
          <label>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label>
          <input type="date" id="editBirthDate" required>
        </div>
        <div class="form-group">
          <label>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
          <input type="text" id="editIdCard">
        </div>
        <div class="form-group">
          <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
          <input type="email" id="editEmail">
        </div>
        <div class="form-group">
          <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <select id="editStatus" required>
            <option value="confirmed">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
            <option value="pending">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
            <option value="rejected">‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
          <textarea id="editNotes" style="min-height:80px"></textarea>
        </div>
        <div style="display:flex;gap:12px;margin-top:20px">
          <button type="submit" class="btn btn-primary" style="flex:1">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button type="button" class="btn btn-secondary" style="flex:1" onclick="closeEditModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let submissions = [];
    let currentSort = { field: 'timestamp', order: 'desc' };
    let currentPage = 1;
    const itemsPerPage = 10;
    let editingId = null;

    // Load submissions on page load
    function loadSubmissions(){
      try{
        submissions = JSON.parse(localStorage.getItem('submissions') || '[]');
        renderTable();
        updateStats();
      }catch(e){
        console.error('Error loading submissions:', e);
        submissions = [];
      }
    }

    // Update stats
    function updateStats(){
      const total = submissions.length;
      const confirmed = submissions.filter(s => s.status === 'confirmed').length;
      const pending = submissions.filter(s => s.status === 'pending').length;
      const rejected = submissions.filter(s => s.status === 'rejected').length;

      document.getElementById('totalCount').textContent = total;
      document.getElementById('confirmedCount').textContent = confirmed;
      document.getElementById('pendingCount').textContent = pending;
      document.getElementById('rejectedCount').textContent = rejected;
    }

    // Get filtered and sorted data
    function getFilteredData(){
      let filtered = submissions;

      // Apply search
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      if(searchTerm){
        filtered = filtered.filter(s => {
          const info = s.personalInfo || {};
          const fullName = `${info.firstName || ''} ${info.lastName || ''}`.toLowerCase();
          const email = (info.email || '').toLowerCase();
          const idCard = (info.idCard || '').toLowerCase();
          return fullName.includes(searchTerm) || email.includes(searchTerm) || idCard.includes(searchTerm);
        });
      }

      // Apply status filter
      const statusFilter = document.getElementById('statusFilter').value;
      if(statusFilter){
        filtered = filtered.filter(s => (s.status || 'pending') === statusFilter);
      }

      // Sort
      filtered.sort((a, b) => {
        let aVal, bVal;
        switch(currentSort.field){
          case 'timestamp':
            aVal = new Date(a.timestamp).getTime();
            bVal = new Date(b.timestamp).getTime();
            break;
          case 'id':
            aVal = a.id;
            bVal = b.id;
            break;
          default:
            aVal = a[currentSort.field];
            bVal = b[currentSort.field];
        }
        return currentSort.order === 'asc' ? (aVal > bVal ? 1 : -1) : (aVal < bVal ? 1 : -1);
      });

      return filtered;
    }

    // Render table
    function renderTable(){
      const filtered = getFilteredData();
      const tbody = document.getElementById('tableBody');
      
      if(filtered.length === 0){
        tbody.innerHTML = '<tr><td colspan="10" style="text-align:center;color:#999;padding:40px">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
        document.getElementById('pagination').innerHTML = '';
        return;
      }

      // Pagination
      const totalPages = Math.ceil(filtered.length / itemsPerPage);
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageData = filtered.slice(start, end);

      // Render rows
      tbody.innerHTML = pageData.map(s => {
        const info = s.personalInfo || {};
        const status = s.status || 'pending';
        const statusLabels = { confirmed: '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß', pending: '‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£', rejected: '‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò' };
        return `
          <tr>
            <td><strong>${s.id}</strong></td>
            <td>${new Date(s.timestamp).toLocaleDateString('th-TH')}</td>
            <td>${info.firstName || '-'} ${info.lastName || '-'}</td>
            <td>${info.birthDate || '-'}</td>
            <td>${info.idCard || '-'}</td>
            <td>${info.email || '-'}</td>
            <td>${s.benefit || '-'}</td>
            <td>${(s.documents || []).length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
            <td>${(s.bankAccounts || []).length} ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ <button class="btn btn-secondary" style="font-size:11px;padding:6px 8px;margin-left:6px" onclick="viewAccounts('${s.id}')">‡∏î‡∏π‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button></td>
            <td><span class="badge badge-${status}">${statusLabels[status]}</span></td>
            <td>
              <button class="btn btn-secondary" onclick="editSubmission('${s.id}')" style="font-size:11px;padding:6px 10px">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button class="btn btn-danger" onclick="deleteSubmission('${s.id}')">üóëÔ∏è ‡∏•‡∏ö</button>
            </td>
          </tr>
        `;
      }).join('');

      // Render pagination
      let paginationHTML = '';
      for(let i = 1; i <= totalPages; i++){
        paginationHTML += `<button class="btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
      }
      document.getElementById('pagination').innerHTML = paginationHTML;
    }

    // Sort table
    function sortTable(field){
      if(currentSort.field === field){
        currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
      } else {
        currentSort.field = field;
        currentSort.order = 'asc';
      }
      currentPage = 1;
      renderTable();
    }

    // Go to page
    function goToPage(page){
      currentPage = page;
      renderTable();
    }

    // Edit submission
    function editSubmission(id){
      const submission = submissions.find(s => s.id === id);
      if(!submission) return;

      editingId = id;
      const info = submission.personalInfo || {};
      document.getElementById('editFirstName').value = info.firstName || '';
      document.getElementById('editLastName').value = info.lastName || '';
      document.getElementById('editBirthDate').value = info.birthDate || '';
      document.getElementById('editIdCard').value = info.idCard || '';
      document.getElementById('editEmail').value = info.email || '';
      document.getElementById('editStatus').value = submission.status || 'pending';
      document.getElementById('editNotes').value = submission.notes || '';

      document.getElementById('editModal').classList.add('active');
    }

    // Save edit
    document.getElementById('editForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const submission = submissions.find(s => s.id === editingId);
      if(!submission) return;

      submission.personalInfo.firstName = document.getElementById('editFirstName').value;
      submission.personalInfo.lastName = document.getElementById('editLastName').value;
      submission.personalInfo.birthDate = document.getElementById('editBirthDate').value;
      submission.personalInfo.idCard = document.getElementById('editIdCard').value;
      submission.personalInfo.email = document.getElementById('editEmail').value;
      submission.status = document.getElementById('editStatus').value;
      submission.notes = document.getElementById('editNotes').value;

      localStorage.setItem('submissions', JSON.stringify(submissions));
      alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
      closeEditModal();
      renderTable();
      updateStats();
    });

    // Close edit modal
    function closeEditModal(){
      document.getElementById('editModal').classList.remove('active');
      editingId = null;
    }

    // View accounts modal
    function viewAccounts(id){
      const submission = submissions.find(s => s.id === id);
      if(!submission) return;
      const accounts = submission.bankAccounts || [];
      const container = document.getElementById('accountsModalBody');
      if(!accounts.length){
        container.innerHTML = '<div style="padding:12px;color:#666">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏ô‡∏ö</div>';
      } else {
        container.innerHTML = accounts.map((a,i)=>`<div style="padding:8px;border-bottom:1px solid #f0f0f0"><strong>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏•‡πà‡∏°‡∏ó‡∏µ‡πà ${i+1}</strong><div>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: ${a.bank||'-'}</div><div>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${a.depositType||'-'}</div><div>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ${a.usageType||'-'}</div><div>‡∏¢‡∏≠‡∏î: ${a.balance||'-'}</div><div>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${a.notes||'-'}</div></div>`).join('');
      }
      document.getElementById('accountsModal').classList.add('active');
    }

    function closeAccountsModal(){
      document.getElementById('accountsModal').classList.remove('active');
    }

    // Delete submission
    function deleteSubmission(id){
      if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ?')){
        submissions = submissions.filter(s => s.id !== id);
        localStorage.setItem('submissions', JSON.stringify(submissions));
        currentPage = 1;
        renderTable();
        updateStats();
      }
    }

    // Search and filter handlers
    document.getElementById('searchInput').addEventListener('input', () => {
      currentPage = 1;
      renderTable();
    });

    document.getElementById('statusFilter').addEventListener('change', () => {
      currentPage = 1;
      renderTable();
    });

    // Export to CSV (include bank accounts count)
    function exportToCSV(){
      const filtered = getFilteredData();
      if(!filtered.length){
        alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å');
        return;
      }

      let csv = 'ID,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,‡∏ä‡∏∑‡πà‡∏≠,‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•,‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î,‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß,‡∏≠‡∏µ‡πÄ‡∏°‡∏•,‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏ö‡∏µ‡πâ‡∏¢,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ,‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞,‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏\n';
      
      filtered.forEach(s => {
        const info = s.personalInfo || {};
        const status = { confirmed: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß', pending: '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£', rejected: '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò' }[s.status || 'pending'];
        const accountsCount = (s.bankAccounts || []).length;
        csv += `"${s.id}","${new Date(s.timestamp).toLocaleDateString('th-TH')}","${info.firstName || ''}","${info.lastName || ''}","${info.birthDate || ''}","${info.idCard || ''}","${info.email || ''}","${s.benefit || ''}",${(s.documents || []).length},${accountsCount},"${status}","${(s.notes || '').replace(/"/g, '""')}"\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `submissions_${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
    }

    // Load on page load
    loadSubmissions();
  </script>
</body>
</html>
